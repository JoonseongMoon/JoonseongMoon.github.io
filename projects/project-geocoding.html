<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Batch Geocoding Pipeline — Joonseong</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #ffffff;
    --surface: #f7f7f5;
    --surface-hover: #f0f0ec;
    --border: #e2e0db;
    --border-light: #d5d3ce;
    --text: #2c2c2a;
    --text-muted: #6b6b66;
    --accent: #5a7a6a;
    --accent-dim: #7a9a8a;
    --accent-glow: rgba(90,122,106,0.06);
    --tag-bg: #f2f4f2;
    --tag-border: #dde2dd;
    --code-bg: #f5f5f3;
    --grid-color: rgba(0,0,0,0.04);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; scrollbar-width: thin; scrollbar-color: var(--border-light) transparent; }

  body {
    font-family: 'Instrument Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--grid-color) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none;
    z-index: 0;
  }

  /* ─── Nav ─── */
  nav {
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 100;
    padding: 1.25rem 3rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
  }

  .nav-logo {
    font-family: 'DM Serif Display', serif;
    font-size: 1.3rem;
    color: var(--text);
    text-decoration: none;
    letter-spacing: -0.02em;
  }
  .nav-logo span { color: var(--accent); }

  .back-link {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 0.82rem;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    transition: color 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .back-link:hover { color: var(--accent); }

  /* ─── Project Hero ─── */
  .project-hero {
    padding: 10rem 3rem 4rem;
    max-width: 900px;
    margin: 0 auto;
  }

  .project-hero-category {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .project-hero-category::before {
    content: '';
    width: 24px;
    height: 1px;
    background: var(--accent-dim);
  }

  .project-hero h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2.2rem, 5vw, 3.5rem);
    font-weight: 400;
    line-height: 1.12;
    letter-spacing: -0.02em;
    margin-bottom: 1.5rem;
  }

  .project-hero-desc {
    font-size: 1.1rem;
    color: var(--text-muted);
    line-height: 1.8;
    max-width: 650px;
    margin-bottom: 2rem;
  }

  .project-meta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
  }

  .project-meta-item {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .project-meta-item .label {
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
  }

  .project-meta-item .value {
    font-size: 0.88rem;
    color: var(--text);
  }

  /* ─── Cover Image ─── */
  .project-cover {
    width: 100%;
    max-width: 1100px;
    margin: 0 auto 4rem;
    padding: 0 3rem;
  }

  .project-cover img, .project-cover .cover-placeholder {
    width: 100%;
    border-radius: 12px;
    border: 1px solid var(--border);
  }

  .cover-placeholder {
    height: 400px;
    background: linear-gradient(135deg, #f0eeec, #eef2f0, #f0eef2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  /* ─── Content Area ─── */
  .project-content {
    max-width: 780px;
    margin: 0 auto;
    padding: 0 3rem 6rem;
  }

  /* ─── Section Blocks ─── */
  .content-section {
    margin-bottom: 4rem;
  }

  .content-section-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent-dim);
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .content-section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .content-section h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.6rem;
    font-weight: 400;
    margin-bottom: 1rem;
    letter-spacing: -0.01em;
  }

  .content-section h3 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.2rem;
    font-weight: 400;
    margin: 2rem 0 0.75rem;
    letter-spacing: -0.01em;
  }

  .content-section p {
    color: var(--text-muted);
    font-size: 0.95rem;
    line-height: 1.85;
    margin-bottom: 1rem;
  }

  .content-section p strong {
    color: var(--text);
    font-weight: 500;
  }

  /* ─── Code Block ─── */
  .code-block {
    margin: 2rem 0;
    border-radius: 10px;
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.65rem 1rem;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    color: var(--text-muted);
  }

  .code-dots {
    display: flex;
    gap: 6px;
  }
  .code-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--border-light);
  }

  .code-block pre {
    padding: 1.25rem;
    background: var(--code-bg);
    overflow-x: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    line-height: 1.7;
    color: var(--text-muted);
  }

  .code-block pre .comment { color: #8a8a84; }
  .code-block pre .keyword { color: var(--accent); }
  .code-block pre .string { color: #4a7a5a; }
  .code-block pre .function { color: #4a7a9a; }
  .code-block pre .number { color: #8a6a3a; }

  /* ─── Timeline ─── */
  .timeline {
    margin: 2rem 0;
    position: relative;
    padding-left: 2rem;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 3px;
    top: 8px;
    bottom: 8px;
    width: 1px;
    background: var(--border);
  }

  .timeline-item {
    position: relative;
    margin-bottom: 2rem;
    padding-left: 1.5rem;
  }

  .timeline-item:last-child { margin-bottom: 0; }

  .timeline-item::before {
    content: '';
    position: absolute;
    left: -2rem;
    top: 8px;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--accent-dim);
    border: 2px solid var(--bg);
    box-shadow: 0 0 0 1px var(--accent-dim);
  }

  .timeline-date {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--accent-dim);
    margin-bottom: 0.35rem;
    letter-spacing: 0.05em;
  }

  .timeline-title {
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 0.35rem;
  }

  .timeline-desc {
    color: var(--text-muted);
    font-size: 0.85rem;
    line-height: 1.7;
  }

  /* ─── Highlight Box ─── */
  .highlight-box {
    margin: 2rem 0;
    padding: 1.5rem 1.75rem;
    background: var(--accent-glow);
    border: 1px solid var(--tag-border);
    border-left: 3px solid var(--accent-dim);
    border-radius: 0 10px 10px 0;
  }

  .highlight-box h4 {
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--accent);
  }

  .highlight-box ul {
    list-style: none;
    padding: 0;
  }

  .highlight-box ul li {
    padding: 0.35rem 0;
    padding-left: 1.25rem;
    position: relative;
    color: var(--text-muted);
    font-size: 0.88rem;
    line-height: 1.6;
  }

  .highlight-box ul li::before {
    content: '→';
    position: absolute;
    left: 0;
    color: var(--accent-dim);
  }

  /* ─── Tags row ─── */
  .tags-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin: 1rem 0;
  }

  .tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    padding: 0.3rem 0.65rem;
    background: var(--tag-bg);
    border: 1px solid var(--tag-border);
    border-radius: 4px;
    color: var(--text-muted);
  }

  /* ─── Next / Prev Project Navigation ─── */
  .project-nav {
    max-width: 780px;
    margin: 0 auto;
    padding: 0 3rem 6rem;
    display: flex;
    justify-content: space-between;
    gap: 1rem;
  }

  .project-nav a {
    flex: 1;
    padding: 1.5rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .project-nav a:hover {
    border-color: var(--accent-dim);
    transform: translateY(-2px);
  }

  .project-nav .nav-direction {
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
  }

  .project-nav .nav-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.1rem;
    color: var(--text);
  }

  .project-nav a.next { text-align: right; }

  /* ─── Footer ─── */
  footer {
    padding: 2rem 3rem;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  @media (max-width: 768px) {
    nav { padding: 1rem 1.5rem; }
    .project-hero { padding: 8rem 1.5rem 3rem; }
    .project-cover { padding: 0 1.5rem; }
    .project-content { padding: 0 1.5rem 4rem; }
    .project-meta-row { flex-direction: column; gap: 1rem; }
    .project-nav { flex-direction: column; padding: 0 1.5rem 4rem; }
    footer { flex-direction: column; gap: 0.75rem; text-align: center; }
  }
</style>
</head>
<body>

<!-- ─── Nav ─── -->
<nav>
  <a href="../index.html" class="nav-logo">JS<span>.</span></a>
  <a href="../index.html" class="back-link">&larr; Back to Home</a>
</nav>

<!-- ─── Project Hero ─── -->
<div class="project-hero">
  <div class="project-hero-category">GIS / Data Engineering</div>
  <h1>Batch Geocoding Pipeline with Multi-Service Validation</h1>
  <p class="project-hero-desc">
    Built a Python pipeline to batch-geocode 671 building addresses using Google Maps and ArcGIS APIs, then cross-validated results on an interactive Folium map with geodesic distance calculations to quantify discrepancies between services.
  </p>
  <div class="project-meta-row">
    <div class="project-meta-item">
      <span class="label">Type</span>
      <span class="value">CBPD Research Project</span>
    </div>
    <div class="project-meta-item">
      <span class="label">Year</span>
      <span class="value">2025</span>
    </div>
    <div class="project-meta-item">
      <span class="label">Role</span>
      <span class="value">Graduate Research Assistant</span>
    </div>
    <div class="project-meta-item">
      <span class="label">Stack</span>
      <span class="value">Python, Geopy, Folium, Pandas</span>
    </div>
  </div>
</div>

<!-- ─── Cover ─── -->
<div class="project-cover">
  <img src="project-geocoding/titlepage.png" alt="Folium Map — Google vs ArcGIS Geocoding Comparison" style="width:100%;border-radius:12px;border:1px solid var(--border);">
</div>

<!-- ─── Content ─── -->
<div class="project-content">

  <!-- The Problem -->
  <div class="content-section">
    <div class="content-section-label">Context</div>
    <h2>The Problem</h2>
    <p>
      As part of my research assistant work, I needed to convert a dataset of <strong>671 building addresses</strong> stored in an Excel spreadsheet into latitude/longitude coordinates for spatial analysis. The challenge wasn't just geocoding at scale. It was ensuring the results were <strong>accurate and reliable</strong>. A single geocoding service can silently return wrong coordinates (e.g., snapping to the wrong street, city, or even country), so I needed a way to cross-validate results across multiple providers.
    </p>
  </div>

  <!-- Pipeline Architecture -->
  <div class="content-section">
    <div class="content-section-label">Approach</div>
    <h2>Pipeline Architecture</h2>
    <p>
      I built the project in three stages, each building on the previous one.
    </p>
    <div class="timeline">
      <div class="timeline-item">
        <div class="timeline-date">Stage 1 — Google Geocoding</div>
        <div class="timeline-title">GoogleAPI_Geocoding.py</div>
        <div class="timeline-desc">Batch geocoding all 671 addresses using the Google Maps Geocoding API via Geopy's GoogleV3 client. Built with automatic retry logic (up to 3 attempts per address), rate limiting, and checkpoint saving every 50 records so the process can resume if interrupted.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">Stage 2 — ArcGIS Fallback</div>
        <div class="timeline-title">ARCGIS_Geocoding.py</div>
        <div class="timeline-desc">A multi-service geocoding pipeline using ArcGIS as the primary provider (with Nominatim available as a commented-out fallback). Same robust batch processing pattern with retry logic, progress saving, and separate failed-address export for manual review.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">Stage 3 — Visual Cross-Validation</div>
        <div class="timeline-title">Folium_map.py</div>
        <div class="timeline-desc">An interactive Folium map that loads both Google and ArcGIS results, plots them as color-coded markers (blue = Google, red = ArcGIS), and draws match lines with geodesic distance calculations to quantify exactly how much the two services disagree for each address.</div>
      </div>
    </div>
  </div>

  <!-- Google Geocoder -->
  <div class="content-section">
    <div class="content-section-label">Stage 1</div>
    <h2>Google Maps Geocoding</h2>
    <p>
      The first script reads addresses from a master Excel file and geocodes each one through the <strong>Google Maps Geocoding API</strong>. The key design decisions were around resilience. Geocoding 671 addresses takes time, and any network hiccup could waste work already done.
    </p>

    <div class="code-block">
      <div class="code-header">
        <div class="code-dots"><span></span><span></span><span></span></div>
        <span>GoogleAPI_Geocoding.py</span>
      </div>
      <pre><span class="keyword">def</span> <span class="function">geocode_with_google</span>(address, api_key, attempt=<span class="number">1</span>, max_attempts=<span class="number">3</span>):
    <span class="keyword">try</span>:
        geolocator = GoogleV3(api_key=api_key, timeout=<span class="number">10</span>)
        location = geolocator.geocode(address)
        <span class="keyword">if</span> location:
            <span class="keyword">return</span> location.latitude, location.longitude, <span class="string">"Google"</span>
        time.sleep(<span class="number">0.5</span>)
    <span class="keyword">except</span> (GeocoderTimedOut, GeocoderServiceError) <span class="keyword">as</span> e:
        <span class="keyword">if</span> attempt &lt; max_attempts:
            time.sleep(<span class="number">2</span>)
            <span class="keyword">return</span> geocode_with_google(address, api_key, attempt + <span class="number">1</span>)
    <span class="keyword">return</span> <span class="keyword">None</span>, <span class="keyword">None</span>, <span class="keyword">None</span></pre>
    </div>

    <div class="highlight-box">
      <h4>Design Features</h4>
      <ul>
        <li><strong>Recursive retry</strong> — up to 3 attempts per address with exponential backoff on timeout/service errors</li>
        <li><strong>Checkpoint saving</strong> — exports progress to Excel every 50 rows so work isn't lost on interruption</li>
        <li><strong>Failed address export</strong> — automatically writes unresolved addresses to a separate file for manual review</li>
        <li><strong>Status tracking</strong> — each row gets a status column (Success, Failed, Empty Address) for downstream filtering</li>
      </ul>
    </div>
  </div>

  <!-- ArcGIS Fallback -->
  <div class="content-section">
    <div class="content-section-label">Stage 2</div>
    <h2>Multi-Service Fallback Pipeline</h2>
    <p>
      The second script takes a different approach. Instead of relying on a single paid API, it uses <strong>ArcGIS's free geocoding service</strong> as the primary provider, with Nominatim (OpenStreetMap) available as an additional fallback. This design means addresses that one service can't resolve might be caught by another.
    </p>

    <div class="code-block">
      <div class="code-header">
        <div class="code-dots"><span></span><span></span><span></span></div>
        <span>ARCGIS_Geocoding.py — fallback chain</span>
      </div>
      <pre><span class="keyword">def</span> <span class="function">geocode_with_fallback</span>(address, google_api_key=<span class="keyword">None</span>):
    <span class="comment"># Try ArcGIS first (free, no API key needed)</span>
    lat, lon, source = geocode_with_arcgis(address)
    <span class="keyword">if</span> lat <span class="keyword">is not None</span>:
        <span class="keyword">return</span> lat, lon, source

    <span class="keyword">return</span> <span class="keyword">None</span>, <span class="keyword">None</span>, <span class="string">"All services failed"</span></pre>
    </div>

    <p>
      The script also includes a commented-out <strong>address cleaning function</strong> that expands abbreviations (St → Street, Ave → Avenue, etc.) to improve geocoder hit rates. This was tested but ultimately not needed for this dataset since most addresses were already well-formatted.
    </p>
  </div>

  <!-- Folium Visualization -->
  <div class="content-section">
    <div class="content-section-label">Stage 3</div>
    <h2>Cross-Validation Map</h2>
    <p>
      The final and most interesting piece is the <strong>interactive Folium map</strong> that visually compares the Google and ArcGIS results side by side. For each address that both services geocoded, it draws a line between the two returned coordinates and calculates the geodesic distance between them.
    </p>

    <div class="code-block">
      <div class="code-header">
        <div class="code-dots"><span></span><span></span><span></span></div>
        <span>Folium_map.py — distance-based color coding</span>
      </div>
      <pre><span class="comment"># Color-code match lines by geodesic distance</span>
<span class="keyword">for</span> _, r <span class="keyword">in</span> merged.iterrows():
    g_pt = (r[google_lat_col], r[google_lon_col])
    a_pt = (r[arc_lat_use], r[arc_lon_use])
    dist_m = geodesic(g_pt, a_pt).meters

    <span class="keyword">if</span> dist_m &lt; <span class="number">5</span>:
        col = <span class="string">"green"</span>     <span class="comment"># excellent match</span>
    <span class="keyword">elif</span> dist_m &lt; <span class="number">20</span>:
        col = <span class="string">"orange"</span>    <span class="comment"># minor discrepancy</span>
    <span class="keyword">else</span>:
        col = <span class="string">"red"</span>       <span class="comment"># needs manual review</span>

    tooltip = <span class="string">f"{r[key_col]} | Δ={dist_m:.2f} m"</span>
    folium.PolyLine([g_pt, a_pt], color=col, weight=<span class="number">2</span>,
                    tooltip=tooltip).add_to(lines_layer)</pre>
    </div>

    <p>
      The map supports multiple interactive layers. Toggle Google points, ArcGIS points, marker clusters, and the match lines independently. Hovering over any match line shows the address and the exact distance discrepancy in meters.
    </p>
    <p>
      It also handles coordinate system conversion. If ArcGIS returns results in Web Mercator (EPSG:3857) instead of WGS84, a <strong>pyproj Transformer</strong> reprojects the coordinates before comparison.
    </p>

    <div class="highlight-box">
      <h4>Map Features</h4>
      <ul>
        <li><strong>Dual-layer markers</strong> — blue circles (Google) and red circles (ArcGIS) plotted simultaneously</li>
        <li><strong>MarkerCluster support</strong> — optional clustering for dense areas to keep the map readable</li>
        <li><strong>Geodesic match lines</strong> — color-coded green (&lt;5m), orange (&lt;20m), red (&gt;20m) by distance</li>
        <li><strong>Interactive tooltips</strong> — hover any line to see the address and exact meter discrepancy</li>
        <li><strong>LayerControl</strong> — toggle each layer on/off independently to isolate specific views</li>
      </ul>
    </div>
  </div>

  <!-- What I Learned -->
  <div class="content-section">
    <div class="content-section-label">Reflection</div>
    <h2>What I Learned</h2>
    <p>
      This project reinforced a few practical lessons about working with geospatial data at scale.
    </p>
    <p>
      <strong>No single geocoder is perfect.</strong> Google and ArcGIS frequently disagreed by 10–50+ meters for the same address, especially for rural locations and newer developments. Cross-validation caught errors that a single-service approach would have missed entirely.
    </p>
    <p>
      <strong>Resilience matters more than speed.</strong> Checkpoint saving every 50 rows and automatic retry logic turned what could have been a frustrating process into something I could run overnight without worrying about lost progress.
    </p>
    <p>
      <strong>Visualization is the fastest way to validate spatial data.</strong> Plotting 671 points on a map and color-coding discrepancies made it immediately obvious which addresses needed attention, something a spreadsheet of lat/lon pairs could never reveal as quickly.
    </p>
  </div>

  <!-- Stack -->
  <div class="content-section">
    <div class="content-section-label">Stack</div>
    <h2>Technical Stack</h2>
    <div class="tags-row">
      <span class="tag">Python</span>
      <span class="tag">Pandas</span>
      <span class="tag">Geopy</span>
      <span class="tag">Google Maps API</span>
      <span class="tag">ArcGIS Geocoder</span>
      <span class="tag">Folium</span>
      <span class="tag">MarkerCluster</span>
      <span class="tag">Geodesic Distance</span>
      <span class="tag">pyproj</span>
      <span class="tag">Batch Processing</span>
    </div>
  </div>

</div>

<!-- ─── Next / Previous Project ─── -->
<div class="project-nav">
  <a href="project-energy-audit.html">
    <span class="nav-direction">&larr; Previous</span>
    <span class="nav-title">Energy Audit Assistant</span>
  </a>
  <a href="project-snow-detection.html" class="next">
    <span class="nav-direction">Next &rarr;</span>
    <span class="nav-title">Roof Snow Detection</span>
  </a>
</div>

<footer>
  <span>&copy; 2025 Joonseong. Built with care.</span>
  <span>Pittsburgh, PA</span>
</footer>

</body>
</html>
